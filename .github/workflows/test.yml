name: Manually Build

on:
  workflow_dispatch:
    inputs:
      artifact:
        description: 'select which job to run("all" will make all jobs run)'
        required: true
        default: 'all'
        type: choice
        options:
        - all
        - docker-bigdl-ppml-trusted-big-data-ml-python-gramine
        - docker-bigdl-ppml-trusted-big-data-ml-python-graphene
        - docker-bigdl-ppml-trusted-big-data-ml-scala-occlum
        - docker-bigdl-ppml-trusted-realtime-ml-scala-graphene
        - docker-bigdl-ppml-trusted-realtime-ml-scala-occlum
        - docker-kmsutil
        - docker-pccs
      tag:
        description: 'docker image tag (e.g. 2.1.0-SNAPSHOT)'
        required: true
        default: 'latest'
        type: string

permissions:
  contents: read
  packages: write


jobs:

  test_env:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3
    - name: echo the variable
      run: |
        echo "TAG=${{ env.DEFAULT_TAG }}"
    - name: set env
      env:
        DEFAULT_TAG: 'latest'
      run: |
        echo "TAG=${{ github.event.inputs.tag || env.DEFAULT_TAG }} " >> $GITHUB_ENV
    - name: Run test
      uses: ./.github/actions/ppml-spark-local-example-tests-on-gramine-action
      with:
        image-tag: ${TAG}
